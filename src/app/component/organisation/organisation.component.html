<div class="container">
  <div class="row">
    <ng-container *ngIf="organisation !== undefined">
      <h1>Организация ({{organisation.displayName}} ИНН:{{organisation.inn}})</h1>
    </ng-container>
    <ng-container *ngIf="organisation !== undefined" >

      <ng-container *ngFor="let department of organisation.departments">
        <h2>{{department.displayName}}</h2>
        <table mat-table [dataSource]="department.users" class="organisation-table mat-elevation-z8" multiTemplateDataRows>

          <ng-container matColumnDef="user-name">
            <th mat-header-cell *matHeaderCellDef width="300"> Ф.И.О. </th>
            <td mat-cell *matCellDef="let user">
              <ng-container *ngIf="this.organisationService.hasDepartmentHeadRole(user)">
                <span class="bold-text" >{{ user.lastName + ' ' + user.firstName + ' ' + user.middleName}}</span>
              </ng-container>
              <ng-container *ngIf="!this.organisationService.hasDepartmentHeadRole(user)">
                <span class="">{{ user.lastName + ' ' + user.firstName + ' ' + user.middleName}}</span>
              </ng-container>
            </td>
          </ng-container>

          <ng-container matColumnDef="user-position" >
            <th mat-header-cell *matHeaderCellDef width="220"> Должность </th>
            <td mat-cell *matCellDef="let user"> {{ user.position }} </td>
          </ng-container>

          <ng-container matColumnDef="user-vacations">
            <th mat-header-cell *matHeaderCellDef class="text-center"> Отпуска </th>
            <td mat-cell *matCellDef="let user" class="text-center">
              <span *ngIf="user.vacations === null">Нет данных</span>
              <div class="vacations-table-list">
                <span *ngFor="let vacation of user.vacations">{{'c: ' + this.parseStringToDate(vacation.dateFrom) + ' по: ' + this.parseStringToDate(vacation.dateTo)}}</span>
              </div>
            </td>
          </ng-container>

          <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
          <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let user" [attr.colspan]="displayedColumns.length">
              <div class="element-detail"
                   [@detailExpand]="user == expandedElement ? 'expanded' : 'collapsed'">
                <span *ngIf="user.vacations === null">Нет данных</span>
                <div class="vacations-table-list">
                  <span *ngFor="let vacation of user.vacations">{{'c: ' + this.parseStringToDate(vacation.dateFrom) + ' по: ' + this.parseStringToDate(vacation.dateTo)}}</span>
                </div>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr class="hoverable user-row" mat-row *matRowDef="let user; columns: displayedColumns;"
              [class.expanded-row]="expandedElement === user"
              (click)="expandedElement = expandedElement === user ? null : user"></tr>
          <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>

        </table>
      </ng-container>

    </ng-container>
  </div>
</div>
